{% extends 'base.html' %}
{% load static %}
{% block style %}
    <link rel="stylesheet" href="{% static './style.css' %}">
    <link rel="stylesheet" href="{% static './index.css' %}">
{% endblock %}
{% block title %}
    StoryHub | Share your story
{% endblock %}
{% block header %}
    {% include 'components/index-header.html' %}
{% endblock %}
{% block content %}
    <main>
        <section class="empty"></section>
        <section class="story">
            <div class="story-list">
                <div style="display: flex; align-items: center">
                    <a href="{% url 'index' %}">

                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="back-arrow">
                            <g>
                                <path d="M13.83 19a1 1 0 0 1-.78-.37l-4.83-6a1 1 0 0 1 0-1.27l5-6a1 1 0 0 1 1.54 1.28L10.29 12l4.32 5.36a1 1 0 0 1-.78 1.64z"></path>
                            </g>
                        </svg>

                    </a>

                    <h2>Stories</h2>
                </div>

                <div id="list">


                    <div class="story-item">
                        <div class="profile">
                            <img src="https://avatar.iran.liara.run/public" alt="Profile">
                            <span class="profile_name">{{ story.author.get_full_name }}</span>
                        </div>
                        <h3>{{ story.title }}</h3>
                        <p>
                            {{ story.content | safe }}
                        </p>
                        <div class="tags">

                            {% if story.get_tags %}
                                <span># {{ story.get_tags }}</span>
                            {% endif %}

                        </div>
                        <div class="stats">
                            <p>
                                    <span
                                            hx-post="{% url 'like' story.id %}"
                                            hx-trigger="click"
                                            hx-target="#story-like-{{ story.id }}"
                                            hx-swap="outerHTML"
                                            class="like-btn"
                                    >‚ô•Ô∏è</span>
                                <span id="story-like-{{ story.id }}">{{ story.get_like_count }}</span> Likes
                            </p>
                            <p>
                                <span>üí¨</span>
                                <span>{{ story.get_comment_count }}</span> Comments
                            </p>
                        </div>
                    </div>

                    <div class="story-comment">
                        <h3>Comments</h3>
                        <div class="comment-form">
                            <textarea name="comment" id="comment" required></textarea>
                            <button class="btn btn-submit"
                                    hx-post="{% url 'comment' story.id %}"
                                    hx-trigger="click"
                                    hx-target="#comment-list"
                                    hx-swap="afterbegin"
                                    hx-include="#comment">Comment
                            </button>
                        </div>
                        <div id="comment-list">
                            {% for comment in story.get_comments %}
                                <div class="comment" id="comment-item-{{ comment.id }}">
                                    <div class="profile">
                                        <div class="profile">
                                            <img src="https://avatar.iran.liara.run/public" alt="Profile">
                                            <span class="profile_name">{{ comment.author.get_full_name }}</span>


                                            {% if request.user == comment_.author %}

                                                <span class="close"
                                                      hx-delete="{% url 'comment' comment_.id %}"
                                                      hx-trigger="click"
                                                      hx-target="#comment-item-{{ comment_.id }}"
                                                      hx-swap="innerHTML transition:true"
                                                >&times;</span>

                                            {% endif %}

                                        </div>
                                    </div>
                                    <p>
                                        {{ comment.content | safe }}
                                    </p>
                                </div>
                            {% endfor %}
                        </div>

                    </div>
                </div>

            </div>
        </section>

        <aside class="categories">
            <div class="top">
                <h2>Top Cas</h2>
                <ul>

                    {% for story in top_stories %}
                        <li>
                            <a href="{% url 'detail' story.id %}">{{ story.title }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </aside>
        <script>
            document.addEventListener('htmx:configRequest', (event) => {
                event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
            });

            document.addEventListener('htmx:afterRequest', (event) => {
                document.getElementById('comment').value = '';
            });

        </script>
    </main>
{% endblock %}